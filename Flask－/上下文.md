`
from werkzeug.serving import run_simple
from werkzeug.wrappers import Response,Request
`

→   run()  实际调用的run_simple方法        run_simple(host, port, app, **options)

。。。 为什么这里会 调用该应用的__call__方法（）


    →   app.__call__(environ, start_response)
    →   app.wsgi_app(environ, start_response)
    
        →   ctx = self.request_context(environ)   
                    # 返回 RequestContext(app, environ)   
                    # ctx.app = app
                    # if request is None:
                    #     request = app.request_class(environ)
                    #     序列化原始请求信息 - --> request对象
                    # ctx.request = request
                    # ctx.session = None  
                    
            try:
                try:
        →           ctx.push()
        
                        # top = _request_ctx_stack.top  
                        
                                # _request_ctx_stack=LocalStarck(); _request_ctx_stack._local={__storage__:{},__ident_func__:getident # 协程\线程的id号}
                                    
                                →   返回  _request_ctx_stack._local.stack[-1]
                                
                                    →   Local实例没有  stack 属性
                                        触发实例的 __getattr__('stack') 方法
                                        
                                        →    返回 __storage__[self.__ident_func__()]['stack']
                                             捕捉异常,抛出valueerror 'stack'
                                →   捕捉异常
                                    返回  None
                        # 应用上文 
                        # app_ctx = _app_ctx_stack.top
                        # if app_ctx is None or app_ctx.app != ctx.app:
                        #     app_ctx = self.app.app_context()
                        #     app_ctx.push()
                        #     ctx._implicit_app_ctx_stack.append(app_ctx)
                        # else:
                        #     ctx._implicit_app_ctx_stack.append(None)
                        # 
                        # if hasattr(sys, 'exc_clear'):
                        #     sys.exc_clear()
                        
                        
                        # 请求上文  # _request_ctx_stack=LocalStarck(); _request_ctx_stack._local={__storage__:{},__ident_func__:getident # 协程\线程的id号}
            →           # _request_ctx_stack.push(self) # self = ctx    --->    session,request
                            # rv = getattr(self._local, "stack", None)  ----> rv = None
                            # if rv is None:
                            #     self._local.stack = rv = []
                            
                                    # ident = self.__ident_func__() # self = _local = Local()对象
                                    # storage = self.__storage__
                                    # try:
                                    #     storage[ident][name] = value  
                                    # except KeyError:
                                    #     storage[ident] = {name: value} # {__storage__:{'id号'：{'stack':[]}},__ident_func__:getident # 协程\线程的id号}
                            
                            # rv.append(obj)    # obj = self= ctx对象# {__storage__:{'id号'：{'stack':[ctx,]}},__ident_func__:getident # 协程\线程的id号}
                            # return rv
                            
                        # if self.session is None: 
                        #     if self.session is None:
                        #         self.session = session_int

        
        
 
        
                    response = self.full_dispatch_request()
                except Exception as e:
                    error = e
                    response = self.handle_exception(e)
                except:
                    error = sys.exc_info()[1]
                    raise
                return response(environ, start_response)
            finally:
                if self.should_ignore_error(error):
                    error = None
                ctx.auto_pop(error)
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
    →    
